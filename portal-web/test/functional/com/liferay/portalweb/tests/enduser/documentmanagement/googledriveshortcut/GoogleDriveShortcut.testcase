@component-name = "portal-document-management"
definition {

	property custom.properties = "default.layout.template.id=1_column${line.separator}dl.actions.visible=true";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Document Management";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		PortalSettings.gotoConfiguration(
			configurationCategory = "Documents and Media",
			configurationName = "Google Drive",
			configurationScope = "Virtual Instance Scope");

		var googleClientId = PropsUtil.get("google.client.id.4");
		var googleClientSecret = PropsUtil.get("google.client.secret.4");
		var googlePickerApiKey = PropsUtil.get("google.api.key.4");

		PortalSettings.configureGoogleDrive(
			googleClientId = ${googleClientId},
			googleClientSecret = ${googleClientSecret},
			googlePickerApiKey = ${googlePickerApiKey});

		JSONLayout.addPublicLayout(
			groupName = "Guest",
			layoutName = "Documents and Media Page");

		JSONLayout.addWidgetToPublicLayout(
			column = 1,
			groupName = "Guest",
			layoutName = "Documents and Media Page",
			widgetName = "Documents and Media");

		Navigator.gotoPage(pageName = "Documents and Media Page");

		LexiconEntry.changeDisplayStyle(displayStyle = "list");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if (${testPortalInstance} == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			DMDocument.tearDownCP();

			DMFolder.tearDownCP();

			DMDocumentType.tearDownCP();

			PagesAdmin.tearDownCP();
		}
	}

	@description = "This test makes sure that the Google Drive Shortcut can be added in a depot."
	@priority = 4
	test CanDeleteGoogleDocInDepot {
		property test.name.skip.portal.instance = "GoogleDriveShortcut#CanDeleteGoogleDocInDepot";

		var siteName = TestCase.getSiteName(siteName = ${siteName});

		JSONDepot.addDepot(
			depotDescription = "This is the description of a depot",
			depotName = "Test Depot Name");

		DepotNavigator.openDepotDocumentsAndMediaAdmin(depotName = "Test Depot Name");

		DMNavigator.gotoAddDocumentTypeCP(dmDocumentTypeName = "Google Drive Shortcut");

		GoogleDrive.gotoDrive(
			userEmailAddress = PropsUtil.get("email.address.4"),
			userPassword = PropsUtil.get("email.password.4"),
			windowTitle = "New Google Drive Shortcut - Test Depot Name - ${siteName}");

		GoogleDrive.selectDocument(
			googleDocName = "liferay.txt",
			googleDocTitle = "liferay");

		PortletEntry.publish();

		DepotNavigator.openDepotDocumentsAndMediaAdmin(depotName = "Test Depot Name");

		DMDocument.deleteCP(dmDocumentTitle = "liferay");
	}

	@priority = 5
	test CanDeleteGoogleDocInSite {
		property test.name.skip.portal.instance = "GoogleDriveShortcut#EditAndDeleteGoogleDoc";

		var siteName = TestCase.getSiteName(siteName = ${siteName});

		Navigator.gotoPage(pageName = "Documents and Media Page");

		Portlet.clickPortletPlusIconPG(portletName = "Documents and Media");

		MenuItem.click(menuItem = "Google Drive Shortcut");

		GoogleDrive.gotoDrive(
			userEmailAddress = PropsUtil.get("email.address.4"),
			userPassword = PropsUtil.get("email.password.4"),
			windowTitle = "New Google Drive Shortcut - ${siteName}");

		GoogleDrive.selectDocument(
			googleDocName = "liferay.txt",
			googleDocTitle = "liferay");

		PortletEntry.publish();

		Navigator.gotoPage(pageName = "Documents and Media Page");

		DMDocument.deletePG(dmDocumentTitle = "liferay");
	}

	@description = "This test makes sure that the Google Drive Shortcut can be added in a depot."
	@priority = 4
	@refactordone
	test CanEditGoogleDocInDepot {
		property test.name.skip.portal.instance = "GoogleDriveShortcut#CanEditGoogleDocInDepot";

		var siteName = TestCase.getSiteName(siteName = ${siteName});

		JSONDepot.addDepot(
			depotDescription = "This is the description of a depot",
			depotName = "Test Depot Name");

		DepotNavigator.openDepotDocumentsAndMediaAdmin(depotName = "Test Depot Name");

		DMNavigator.gotoAddDocumentTypeCP(dmDocumentTypeName = "Google Drive Shortcut");

		GoogleDrive.gotoDrive(
			userEmailAddress = PropsUtil.get("email.address.4"),
			userPassword = PropsUtil.get("email.password.4"),
			windowTitle = "New Google Drive Shortcut - Test Depot Name - ${siteName}");

		GoogleDrive.selectDocument(
			googleDocName = "liferay.txt",
			googleDocTitle = "liferay");

		PortletEntry.publish();

		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "liferay");

		AssertTextEquals(
			key_fieldLabel = "Title",
			locator1 = "TextInput#GENERIC_TEXT_INPUT",
			value1 = "liferay");

		AssertTextEquals(
			key_fieldLabel = "File Name",
			locator1 = "TextInput#GENERIC_TEXT_INPUT",
			value1 = "liferay.txt");

		DepotNavigator.openDepotDocumentsAndMediaAdmin(depotName = "Test Depot Name");

		DMNavigator.gotoDocumentCP(dmDocumentTitle = "liferay");

		DMDocument.viewCP(
			dmDocumentFileName = "liferay.txt",
			dmDocumentTitle = "liferay");
	}

	@priority = 5
	@refactordone
	test CanEditGoogleDocInSite {
		property test.name.skip.portal.instance = "GoogleDriveShortcut#CanEditGoogleDocInSite";

		var siteName = TestCase.getSiteName(siteName = ${siteName});

		Navigator.gotoPage(pageName = "Documents and Media Page");

		Portlet.clickPortletPlusIconPG(portletName = "Documents and Media");

		MenuItem.click(menuItem = "Google Drive Shortcut");

		GoogleDrive.gotoDrive(
			userEmailAddress = PropsUtil.get("email.address.4"),
			userPassword = PropsUtil.get("email.password.4"),
			windowTitle = "New Google Drive Shortcut - ${siteName}");

		GoogleDrive.selectDocument(
			googleDocName = "liferay.txt",
			googleDocTitle = "liferay");

		PortletEntry.publish();

		DMNavigator.openToEditEntryInSite(
			dmDocumentTitle = "liferay",
			groupName = "Guest",
			siteURLKey = "guest");

		GoogleDrive.gotoDrive(
			userEmailAddress = PropsUtil.get("email.address.4"),
			userPassword = PropsUtil.get("email.password.4"));

		GoogleDrive.selectDocument(
			googleDocName = "liferay2.xls",
			googleDocTitle = "liferay2");

		PortletEntry.publish();

		DMDocument.viewPG(dmDocumentTitle = "liferay2");
	}

	@description = "This ensures that a user can move a Google Doc to a folder in a content page."
	@priority = 5
	@refactordone
	test CanMoveGoogleDocToFolder {
		property test.name.skip.portal.instance = "GoogleDriveShortcut#MoveGoogleDocToFolder";

		var siteName = TestCase.getSiteName(siteName = ${siteName});

		JSONLayout.addPublicLayout(
			groupName = "Guest",
			layoutName = "Test Content Page Name",
			type = "content");

		ContentPagesNavigator.openEditContentPage(
			pageName = "Test Content Page Name",
			siteName = "Guest");

		PageEditor.addWidget(portletName = "Documents and Media");

		PageEditor.publish();

		ContentPagesNavigator.openViewContentPage(
			pageName = "Test Content Page Name",
			siteName = "Guest");

		LexiconEntry.changeDisplayStyle(displayStyle = "list");

		Navigator.gotoPage(pageName = "Test Content Page Name");

		LexiconEntry.gotoAdd();

		MenuItem.click(menuItem = "Google Drive Shortcut");

		GoogleDrive.gotoDrive(
			userEmailAddress = PropsUtil.get("email.address.4"),
			userPassword = PropsUtil.get("email.password.4"),
			windowTitle = "New Google Drive Shortcut - ${siteName}");

		GoogleDrive.selectDocument(
			googleDocName = "liferay.txt",
			googleDocTitle = "liferay");

		PortletEntry.publish();

		JSONFolder.addFolder(
			dmFolderDescription = "DM Folder Description",
			dmFolderName = "DM Folder Name",
			groupName = "Guest");

		Navigator.gotoPage(pageName = "Test Content Page Name");

		DMDocument.moveToFolderPG(
			dmDocumentTitle = "liferay",
			dmFolderName = "DM Folder Name");

		DMNavigator.gotoFolder(dmFolderName = "DM Folder Name");

		DMDocument.viewPG(dmDocumentTitle = "liferay");
	}

}