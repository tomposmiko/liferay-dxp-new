@component-name = "portal-workflow"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Workflow";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			DMDocument.tearDownCP();

			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "Content",
				panel = "Site Administration",
				portlet = "Documents and Media"
			);

			Workflow.configureWorkflowViaPortlet(workflowDefinition = "No Workflow");

			DMDocumentType.tearDownCP();
		}
	}

	@priority = "5"
	test ApproveInDMFolderCustomWorkflow {
		property portal.release = "false";
		property testray.component.names = "Training";

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		Organization.addCP(
			orgName = "Space Program Academy of Continuing Education",
			orgType = "Organization"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		UsersAndOrganizationsNavigator.gotoOrganizations();

		Organization.addSiteCP(
			orgName = "Space Program Academy of Continuing Education"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.viewCP(
			siteMember = "Organization",
			siteName = "Space Program Academy of Continuing Education",
			siteType = "Private"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		UsersAndOrganizationsNavigator.gotoOrganizations();

		Organization.addMemberCP(
			orgName = "Space Program Academy of Continuing Education",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Control Panel",
			portlet = "Workflow"
		);

		Workflow.uploadDefinition(
			workflowDefinitionFile = "advanced-governors-review.xml",
			workflowDefinitionTitle = "Quarterly Reports Review Process"
		);

		Workflow.viewDefinition(
			workflowDefinitionName = "Quarterly Reports Review Process",
			workflowDefinitionTitle = "Quarterly Reports Review Process",
			workflowDefinitionVersionNumber = "1"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.assignRegularRoleCP(roleTitle = "Board Member", userScreenName = "usersn");

		ProductMenu.gotoSite(site = "Space Program Academy of Continuing Education");

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media"
		);

		DMFolder.addCP(
			dmFolderDescription = "Financial Reports Description",
			dmFolderName = "Financial Reports"
		);

		DMFolder.configureWorkflowCP(
			dmFolderName = "Financial Reports",
			workflowDefinition = "Quarterly Reports Review Process",
			workflowRestriction = "Default Workflow"
		);

		for (var entryCount : list "1,2,3") {
			ProductMenu.gotoPortlet(
				category = "Content",
				panel = "Site Administration",
				portlet = "Documents and Media"
			);

			DMFolder.viewCP(dmFolderName = "Financial Reports");

			DMDocument.addWithWorkflowCP(
				dmDocumentDescription = "DM Document Description",
				dmDocumentFile = "Document_${entryCount}.doc",
				dmDocumentTitle = "Document_${entryCount}.doc"
			);
		}

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln"
		);

		Navigator.openURL();

		for (var i : list "1,2,3,4") {
			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "My Account",
				panel = "User",
				portlet = "My Workflow Tasks"
			);

			Workflow.assignToMeTaskByActions(
				workflowAssetTitle = "Document_1.doc",
				workflowAssetType = "Document",
				workflowTask = "Board Member Review ${i}"
			);

			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "My Account",
				panel = "User",
				portlet = "My Workflow Tasks"
			);

			Workflow.approveTaskByActions(
				boardWorkflowTask = "${i}",
				workflowAssetTitle = "Document_1.doc",
				workflowAssetType = "Document",
				workflowTask = "Board Member Review ${i}"
			);
		}

		for (var i : list "1,2,3,4") {
			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "My Account",
				panel = "User",
				portlet = "My Workflow Tasks"
			);

			Workflow.assignToMeTaskByActions(
				workflowAssetTitle = "Document_2.doc",
				workflowAssetType = "Document",
				workflowTask = "Board Member Review ${i}"
			);

			Navigator.openURL();

			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "My Account",
				panel = "User",
				portlet = "My Workflow Tasks"
			);

			Workflow.approveTaskByActions(
				boardWorkflowTask = "${i}",
				workflowAssetTitle = "Document_2.doc",
				workflowAssetType = "Document",
				workflowTask = "Board Member Review ${i}"
			);
		}

		for (var i : list "1,2,3,4") {
			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "My Account",
				panel = "User",
				portlet = "My Workflow Tasks"
			);

			Workflow.assignToMeTaskByActions(
				workflowAssetTitle = "Document_3.doc",
				workflowAssetType = "Document",
				workflowTask = "Board Member Review ${i}"
			);

			Navigator.openURL();

			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "My Account",
				panel = "User",
				portlet = "My Workflow Tasks"
			);

			Workflow.approveTaskByActions(
				boardWorkflowTask = "${i}",
				workflowAssetTitle = "Document_3.doc",
				workflowAssetType = "Document",
				workflowTask = "Board Member Review ${i}"
			);
		}

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test"
		);

		Navigator.openURL();

		ProductMenu.gotoSite(site = "Space Program Academy of Continuing Education");

		for (var entryCount : list "1,2,3") {
			ProductMenu.gotoPortlet(
				category = "Content",
				panel = "Site Administration",
				portlet = "Documents and Media"
			);

			DMFolder.viewCP(dmFolderName = "Financial Reports");

			DMDocument.viewCPStatus(
				dmDocumentStatus = "Approved",
				dmDocumentTitle = "Document_${entryCount}.doc"
			);
		}
	}

	@priority = "4"
	test ConfigureFolderWorkflow {
		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media"
		);

		Workflow.configureWorkflowViaFolderInfo(workflowDefinition = "Single Approver");

		DMFolder.addCP(
			dmFolderDescription = "DM Folder Description",
			dmFolderName = "DM Folder Name"
		);

		DMFolder.configureWorkflowCP(
			dmFolderName = "DM Folder Name",
			workflowDefinition = "Single Approver",
			workflowRestriction = "Default Workflow"
		);

		DMFolder.configureWorkflowCP(
			dmFolderName = "DM Folder Name",
			workflowRestriction = "Parent Folder"
		);

		DMFolder.configureWorkflowCP(
			dmDocumentTypeName = "Marketing Banner",
			dmFolderName = "DM Folder Name",
			workflowDefinition = "Single Approver",
			workflowRestriction = "Specific Restrictions"
		);

		DMFolder.configureWorkflowCP(
			dmFolderName = "DM Folder Name",
			workflowDefinition = "No Workflow",
			workflowRestriction = "Default Workflow"
		);
	}

	@description = "This is a use case for LPS-60870."
	@priority = "5"
	test SaveAsDraftAndViewCategories {
		property custom.properties = "dl.file.entry.drafts.enabled=true";
		property testray.component.names = "Training";

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Categorization",
			panel = "Site Administration",
			portlet = "Categories"
		);

		Vocabulary.addCP(vocabularyName = "Vocabulary Name");

		Category.addCP(categoryName = "legal", vocabularyName = "Vocabulary Name");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Categorization",
			panel = "Site Administration",
			portlet = "Categories"
		);

		Category.addCP(categoryName = "Other", vocabularyName = "Vocabulary Name");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media"
		);

		DMFolder.addCP(
			dmFolderDescription = "DM Folder Description",
			dmFolderName = "DM Folder Name"
		);

		DMFolder.configureWorkflowCP(
			dmFolderName = "DM Folder Name",
			workflowDefinition = "Single Approver",
			workflowRestriction = "Default Workflow"
		);

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media"
		);

		DMFolder.viewCP(
			dmDocumentTitle = "DM Folder Name",
			dmFolderName = "DM Folder Name"
		);

		DMNavigator.gotoAddDocumentType();

		DMDocument.editDocument(
			dmDocumentDescription = "DM Document Description",
			dmDocumentFile = "Document_1.doc",
			dmDocumentTitle = "DM Document Title"
		);

		DMDocument.addCategories(
			categoryNameList = "legal,Other",
			vocabularyName = "Vocabulary Name"
		);

		Button.clickSubmitForPublication();

		Alert.viewSuccessMessage();

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "My Account",
			panel = "User",
			portlet = "My Workflow Tasks"
		);

		Workflow.assignToMeTaskByActions(
			workflowAssetTitle = "DM Document Title",
			workflowAssetType = "Document",
			workflowTask = "Review"
		);

		Workflow.approveTaskByActions(
			workflowAssetTitle = "DM Document Title",
			workflowAssetType = "Document",
			workflowTask = "Review"
		);

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media"
		);

		DMFolder.viewCP(
			dmDocumentTitle = "DM Folder Name",
			dmFolderName = "DM Folder Name"
		);

		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "DM Document Title"
		);

		DMDocument.viewCategories(categoryNameList = "legal,Other");

		Button.clickSaveAsDraft();

		Alert.viewSuccessMessage();

		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "DM Document Title"
		);

		DMDocument.viewCategories(categoryNameList = "legal,Other");

		Button.clickSubmitForPublication();

		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "DM Document Title"
		);

		DMDocument.viewCategories(categoryNameList = "legal,Other");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "My Account",
			panel = "User",
			portlet = "My Workflow Tasks"
		);

		Workflow.assignToMeTaskByActions(
			workflowAssetTitle = "DM Document Title",
			workflowAssetType = "Document",
			workflowTask = "Review"
		);

		Workflow.viewTaskAssignedToMeDetails(
			workflowAssetContent = "DM Document Title",
			workflowAssetTitle = "DM Document Title",
			workflowAssetType = "Document",
			workflowTask = "Review"
		);

		Workflow.gotoPreviewEdit();

		DMDocument.viewCategories(categoryNameList = "legal,Other");
	}
}