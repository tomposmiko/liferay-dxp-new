@component-name = "OSB Site Initializer Partner Portal"
definition {

	property custom.properties = "feature.flag.LPS-135430=true";
	property osgi.modules.includes = "osb-site-initializer-partner-portal";
	property portal.release = "false";
	property portal.upstream = "true";
	property release.feature.flags.disable.DISABLE_PRIVATE_LAYOUTS = "true";
	property testray.main.component.name = "OSB Site Initializer Partner Portal";

	setUp {
		task ("Set up instance and sign in") {
			TestCase.setUpPortalInstance();

			User.firstLoginPG();
		}

		task ("Create a new Partner Portal Site and connect with Salesforce") {
			PRMUtils.addSite();

			PRMUtils.connectWithSalesforce();
		}

		task ("Add a Partner user") {
			JSONUser.addUser(
				userEmailAddress = "partner@liferay.com",
				userFirstName = "partner",
				userLastName = "partner",
				userScreenName = "partner");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "partner@liferay.com");
		}

		task ("Add a Manager user") {
			JSONUser.addUserWithRole(
				roleTitle = "Channel General Manager",
				userEmailAddress = "manager@liferay.com",
				userFirstName = "manager",
				userLastName = "manager",
				userScreenName = "manager");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "manager@liferay.com");
		}

		task ("Add a new account and assign the created users to the account") {
			JSONPRM.addAccount();

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Company Name 1",
				userEmailAddress = "partner@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Company Name 1",
				userEmailAddress = "manager@liferay.com");
		}

		task ("Login with the Partner user and create an MDF Request") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "partner@liferay.com",
				userLoginFullName = "partner");

			var requestId = JSONPRM.createMDFRequest(
				campaignName = "Campaign Name",
				userEmailAddress = "partner@liferay.com");
		}

		task ("Go to the created MDF Request") {
			PRMNavigator.openSitePage(pageName = "MDF Requests");

			PRMMDFRequest.goToMDF(campaignName = "Campaign Name");
		}
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if (${testPortalInstance} == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			PRMUtils.tearDown();
		}
	}

	@description = "This is a test for LPS-182807. Verify that managers can edit MDF in Approved status"
	@priority = 5
	test ManagerCanEditMDFInApprovedStatus {
		task ("Given that the manager goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "manager@liferay.com",
				userLoginFullName = "manager");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Approve");
		}

		task ("When the manager edit the MDF informations and submit it") {
			PRMMDFRequest.editButton(manager = "true");

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the informations will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-182809. Verify that managers can edit MDF in Canceled status"
	@priority = 5
	test ManagerCanEditMDFInCanceledStatus {
		task ("Given that the manager goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "manager@liferay.com",
				userLoginFullName = "manager");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Cancel");
		}

		task ("When the manager edit the MDF informations and submit it") {
			PRMMDFRequest.editButton(manager = "true");

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the informations will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-179227. Verify that managers can edit MDF in Marketing Director Review status"
	@priority = 5
	test ManagerCanEditMDFInMarketingDirectorReviewStatus {
		task ("Given that the manager goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "manager@liferay.com",
				userLoginFullName = "manager");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Marketing Director Review");
		}

		task ("When the manager edit the MDF informations and submit it") {
			PRMMDFRequest.editButton(manager = "true");

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the informations will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-182806. Verify that managers can edit MDF in Pending Marketing Review status"
	@priority = 5
	test ManagerCanEditMDFInPendingMarketingReviewStatus {
		task ("Given that the manager goes to the submitted MDF, which is as 'Pending Marketing Review'") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "manager@liferay.com",
				userLoginFullName = "manager");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("When the manager edit the MDF informations and submit it") {
			PRMMDFRequest.editButton(manager = "true");

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the informations will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-182808. Verify that managers can edit MDF in Rejected status"
	@priority = 5
	test ManagerCanEditMDFInRejectedStatus {
		task ("Given that the manager goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "manager@liferay.com",
				userLoginFullName = "manager");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Reject");
		}

		task ("When the manager edit the MDF informations and submit it") {
			PRMMDFRequest.editButton(manager = "true");

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the informations will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

}