@component-name = "portal-solutions"
definition {

	property osgi.modules.includes = "osb-site-initializer-customer-portal";
	property portal.release = "false";
	property portal.upstream = "true";
	property release.feature.flags.disable.DISABLE_PRIVATE_LAYOUTS = "true";
	property testray.main.component.name = "OSB Site Initializer Customer Portal";

	var testSiteName = "Customer Portal Site";
	var testSiteURL = "customer-portal-site";

	setUp {
		task ("Set up instance and sign in") {
			TestCase.setUpPortalInstance();

			User.firstLoginPG();
		}

		task ("Create a new Customer Portal Site") {
			CustomerPortal.addCustomerPortalSite(siteName = "${testSiteName}");
		}
	}

	tearDown {
		CustomerPortal.customerPortalApisTearDown();

		JSONGroup.deleteGroupByName(groupName = "${testSiteName}");

		PortalInstances.tearDownCP();
	}

	@description = "Automation ID: LPS-146856 | Test Summary: Verify that when the status is active the page displays (Subtitle - Link - Link redirects to another page)"
	@priority = "4"
	test AffirmAllTextAndLinksOnThePage {
		CP2DXPCloudSetup.addCPDXPCloudObject();

		CustomerPortal.showCPObject(title = "Account Flag");

		CustomerPortal.showCPObject(title = "Account Subscription Group");

		Accounts.openAccountsAdmin();

		CustomerPortal.accountTableProject(title = "Test Account 01");

		Accounts.addAssigneeToRoleViaUsersTab(
			accountRoleTitle = "Account Administrator",
			accountUserName = "Test Test");

		ApplicationsMenu.gotoSite(key_site = "Customer Portal Site");

		CustomerPortal.enterOnProject(title = "Test Account 01");

		CustomerPortal.clickOnStartProjectSetup();

		CustomerPortal.clickOnSkipForNowButton();

		CustomerPortal.clickOnSkipForNowButton();

		CP2NavigationMenu.goToProductActivation();

		CP2NavigationMenu.clickOnProductButton(product = "DXP Cloud");

		CP2DXPCloudSetup.clickOnFinishActivationButton();

		CP2DXPCloudSetup.typeAllSetupDXPCloudInfoFields();

		CustomerPortal.clickOnSubmitButton();

		CP2DXPCloudSetup.activeStatus();

		ApplicationsMenu.gotoSite(key_site = "Customer Portal Site");

		CustomerPortal.enterOnProject(title = "Test Account 01");

		CP2NavigationMenu.goToProductActivation();

		CP2NavigationMenu.clickOnProductButton(product = "DXP Cloud");

		AssertElementPresent(
			locator1 = "CP2DXPCloudSetup#PRODUCT_CONSOLE",
			value1 = "Go to Product Console");

		CP2DXPCloudSetup.clickOnProductConsoleLink();

		SelectWindow(locator1 = "title=Log in | DXP Cloud");

		AssertElementPresent(locator1 = "CustomerPortalSite#YOUR_ACCOUNT");

		Navigator.closeWindow();

		CP2DXPCloudSetup.clearDXPCloudInfo(status = "Active");

		CustomerPortal.deleteEntryAccountFlag(entry = "ERC-001");

		CustomerPortal.deleteCPObject(title = "Account Flag");

		CP2DXPCloudSetup.deleteDXPCloudObject();
	}

	@description = "LPS-146852 - Verify if when the status is 'In Progress' the page subtitle: 'Your DXP Cloud environments are being set up and will be available soon' appears"
	@priority = "4"
	test CanViewCaptionWhenTheStatusIsInProgress {
		CP2DXPCloudSetup.addCPDXPCloudObject();

		CustomerPortal.showCPObject(title = "Account Flag");

		CustomerPortal.showCPObject(title = "Account Subscription Group");

		Accounts.openAccountsAdmin();

		CustomerPortal.accountTableProject(title = "Test Account 01");

		Accounts.addAssigneeToRoleViaUsersTab(
			accountRoleTitle = "Account Administrator",
			accountUserName = "Test Test");

		ApplicationsMenu.gotoSite(key_site = "Customer Portal Site");

		CustomerPortal.enterOnProject(title = "Test Account 01");

		CustomerPortal.clickOnStartProjectSetup();

		CustomerPortal.clickOnSkipForNowButton();

		CustomerPortal.clickOnSkipForNowButton();

		CP2NavigationMenu.goToProductActivation();

		CP2NavigationMenu.clickOnProductButton(product = "DXP Cloud");

		CP2DXPCloudSetup.clickOnFinishActivationButton();

		CP2DXPCloudSetup.typeAllSetupDXPCloudInfoFields();

		CustomerPortal.clickOnSubmitButton();

		AssertElementPresent(
			locator1 = "CP2DXPCloudSetup#CARD_SUBSCRIPTION",
			title = "Your DXP Cloud environments are being set up and will be available soon");

		CP2DXPCloudSetup.clearDXPCloudInfo(status = "In-Progress");

		CustomerPortal.deleteEntryAccountFlag(entry = "ERC-001");

		CustomerPortal.deleteCPObject(title = "Account Flag");

		CP2DXPCloudSetup.deleteDXPCloudObject();
	}

	@description = "LPS-146849 - Verify if Link 'Finish Activation' hidden to requestor and user roles"
	@priority = "5"
	test NoLinkIsDisplayedWhenYouAreARequesterOrUserRoles {
		ApplicationsMenu.gotoSite(key_site = "Customer Portal Site");

		CustomerPortal.enterOnProject(title = "Test Account 01");

		CP2NavigationMenu.goToProductActivation();

		CP2NavigationMenu.clickOnProductButton(product = "DXP Cloud");

		AssertElementNotPresent(
			locator1 = "CP2DXPCloudSetup#FINISH_ACTIVATION",
			value1 = "Finish Activation");
	}

	@description = "LPS-146843 - Verify that the Activation Form Card - DXP Cloud displays (Product logo - Subscription - Start Date - End Date - Page Subtitleis/Not Activated)"
	@priority = "4"
	test ViewTheDisplaysTheDxpCloudLogo {
		ApplicationsMenu.gotoSite(key_site = "Customer Portal Site");

		CustomerPortal.enterOnProject(title = "Test Account 01");

		CP2NavigationMenu.goToProductActivation();

		CP2NavigationMenu.clickOnProductButton(product = "DXP Cloud");

		CP2DXPCloudSetup.viewActivationStatusCardValue();
	}

	@description = "LPS-146848 - Verify if Link 'Finish Activation' only visible to admin roles"
	@priority = "5"
	test YouCanSeeTheActivationLinkIfYouAreAdmin {
		ApplicationsMenu.gotoSite(key_site = "Customer Portal Site");

		CustomerPortal.enterOnProject(title = "Test Account 01");

		CP2NavigationMenu.goToProductActivation();

		CP2NavigationMenu.clickOnProductButton(product = "DXP Cloud");

		AssertElementNotPresent(
			locator1 = "CP2DXPCloudSetup#FINISH_ACTIVATION",
			value1 = "Finish Activation");

		CustomerPortal.showCPObject(title = "Account Flag");

		Accounts.openAccountsAdmin();

		CustomerPortal.accountTableProject(title = "Test Account 01");

		Accounts.addAssigneeToRoleViaUsersTab(
			accountRoleTitle = "Account Administrator",
			accountUserName = "Test Test");

		ApplicationsMenu.gotoSite(key_site = "Customer Portal Site");

		CustomerPortal.enterOnProject(title = "Test Account 01");

		CustomerPortal.clickOnStartProjectSetup();

		CustomerPortal.clickOnSkipForNowButton();

		CustomerPortal.clickOnSkipForNowButton();

		CP2NavigationMenu.goToProductActivation();

		CP2NavigationMenu.clickOnProductButton(product = "DXP Cloud");

		AssertElementPresent(
			locator1 = "CP2DXPCloudSetup#FINISH_ACTIVATION",
			value1 = "Finish Activation");

		CustomerPortal.deleteEntryAccountFlag(entry = "ERC-001");

		CustomerPortal.deleteCPObject(title = "Account Flag");
	}

}